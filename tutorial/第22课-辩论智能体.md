# 单动作多智能体实例：辩论

这是一个展示如何设计多个智能体并促进它们之间互动的例子，我们将模拟代表正方和反方的智能体共同合作会怎样，这样的组合可能会导致一些充满睿智的交流，辅助我们对一个议题做出更好的决策。

metaGPT官网的实例代码详见：

[https://github.com/geekan/MetaGPT/blob/main/examples/debate.py](https://github.com/geekan/MetaGPT/blob/main/examples/debate.py)

本课进行了一些改编，便于我们用在自己的实际工作中，为我们日常决策提供一个良好的参考。以下的代码推荐在jupyter notebook的代码格子中运行，以便更好地观察到输出结果。

辩论分三个步骤设定：

1. 定义一个具有发言行为的辩手角色，详见前期课程
2. 处理辩手之间的通信，也就是让正方听反方说话，反之亦然
3. 初始化两个辩手实例，正方和反方，创建一个带有环境的团队，并使它们能够相互交互

**导入模块**
```python
import asyncio
from typing import Any

from metagpt.actions import Action, UserRequirement
from metagpt.logs import logger
from metagpt.roles import Role
from metagpt.schema import Message
from metagpt.team import Team
```

**定义动作**

首先，我们需要定义一个Action。这是一个辩论场景，所以让我们将其命名为SpeakAloud

```python
class SpeakAloud(Action):
    """Action: 清楚地阐述自己的观点"""

    PROMPT_TEMPLATE: str = """
    ## 背景
    设想你是 {name}, 你在与 {opponent_name}进行辩论.
    ## 辩论历史记录
    前面的轮次:
    {context}
    ## 轮到你了
    现在轮到你了，
    你应该紧密回应对手的最新论点，
    阐述你的立场，捍卫你的论据，
    并攻击对手的论点，
    构思一个深思熟虑的反驳，你将争论：
    """
    name: str = "SpeakAloud"

    async def run(self, context: str, name: str, opponent_name: str):
        prompt = self.PROMPT_TEMPLATE.format(context=context, name=name, opponent_name=opponent_name)
        # logger.info(prompt)

        rsp = await self._aask(prompt)

        return rsp
```

**定义角色**

定义一个通用的Role，称为Debator

set\_actions使我们的Role拥有我们刚刚定义的SpeakAloud动作。我们还使用\_watch监视了SpeakAloud和 UserRequierment，因为我们希望每个辩手关注来自对手的SpeakAloud消息，以及来自用户的 UserRequirement(人类指令）。

```python
class Debator(Role):
    name: str = ""
    profile: str = ""
    opponent_name: str = ""

    def __init__(self, **data: Any):
        super().__init__(**data)
        self.set_actions([SpeakAloud])
        self._watch([UserRequirement, SpeakAloud])

    async def _observe(self) -> int:
        await super()._observe()
        # accept messages sent (from opponent) to self, disregard own messages from the last round
        self.rc.news = [msg for msg in self.rc.news if msg.send_to == {self.name}]
        return len(self.rc.news)

    async def _act(self) -> Message:
        logger.info(f"{self._setting}: to do {self.rc.todo}({self.rc.todo.name})")
        todo = self.rc.todo  # An instance of SpeakAloud

        memories = self.get_memories()
        context = "\n".join(f"{msg.sent_from}: {msg.content}" for msg in memories)
        # print(context)

        rsp = await todo.run(context=context, name=self.name, opponent_name=self.opponent_name)

        msg = Message(
            content=rsp,
            role=self.profile,
            cause_by=type(todo),
            sent_from=self.name,
            send_to=self.opponent_name,
        )
        self.rc.memory.add(msg)

        return msg
```

上面重写了\_observe函数，我们使每个辩手听取对手论点。这一步很重要，因为在环境中将会有来自正方和反方的 "SpeakAloud 消息"（由SpeakAloud触发的Message）。 我们不希望反方处理自己上一轮的 "SpeakAloud 消息"，而是处理来自正方的消息，反之亦然。


最后，我们使每个辩手能够向对手发送反驳的论点。在这里，我们从消息历史中构建一个上下文，使Debator运行他拥有的SpeakAloud动作，并使用反驳论点内容创建一个新的Message。请注意，我们定义每个Debator将把Message发送给他的对手


**创建团队并添加角色**

建立一个Team将角色动作组合起来，我们将通过将我们的指令（作为UserRequirement）发送给正方，让他先开始。如果你想让反方先说话，将send\_to设置为 "Fan"。

运行main函数就可以看到他们之间的对话！

```python
async def debate(idea: str, investment: float = 3.0, n_round: int = 5):
    """开启辩论过程，充分论证观点"""
    Zheng = Debator(name="Zheng", profile="正方", opponent_name="Fan")
    Fan = Debator(name="Fan", profile="反方", opponent_name="Zheng")
    team = Team()
    team.hire([Zheng, Fan])
    team.invest(investment)
    team.run_project(idea, send_to="Zheng") 
    await team.run(n_round=n_round)


async def main(idea: str, investment: float = 3.0, n_round: int = 5):
    """
    :param idea: 辩论主题
    :param investment: 监控花费的token，不要超出
    :param n_round: 辩论的最大轮次
    :return:
    """
    if platform.system() == "Windows":
        asyncio.set_event_loop_policy(asyncio.WindowsSelectorEventLoopPolicy())
    await debate(idea, investment, n_round)


await main(idea="中小型企业应该训练自己的大模型")
```

运行结果如下：

2025-02-10 15:44:58.224 | INFO     | metagpt.team:invest:90 - Investment: $3.0.
2025-02-10 15:44:58.228 | INFO     | __main__:_act:56 - Zheng(正方): to do SpeakAloud(SpeakAloud)
当然，我明白了。在前面的辩论中，Fan可能提出了诸如“训练大模型需要大量的数据和计算资源，这超出了大多数中小型企业的承受能力”、“大型企业拥有更多的资源和更广泛的数据集，因此更适合开发大模型”等观点。针对这些论点，我会从以下几个方面来构建我的反驳：

1. **成本效益分析**：虽然训练大模型确实需要较高的初期投入，但随着技术的进步和开源工具的普及，这一门槛正在逐步降低。对于中小型企业来说，通过使用云服务提供商提供的API接口或订阅相关服务，可以大幅减少前期投资，并且能够快速获得高质量的服务。此外，许多预训练模型已经公开可用，这些模型经过大规模数据训练后，只需进行微调就能适应特定场景的需求。

2. **差异化竞争**：中小型企业在资源有限的情况下，更需要通过创新来实现差异化竞争。自建大模型可以帮助企业更好地理解自身业务流程和客户需求，从而开发出更加贴合实际需求的产品或服务。这不仅能够提升企业的竞争力，还能为客户提供更加个性化、定制化的解决方案。

3. **合作与共享**：在资源有限的情况下，中小型企业可以与其他企业和研究机构建立合作关系，共同研发大模型。通过资源共享和技术互补，不仅可以降低各自的研发成本，还可以加速技术的迭代和应用。此外，政府和行业组织也可能提供相应的支持政策或资金援助，帮助中小企业克服技术和经济上的障碍。

4. **长期发展潜力**：虽然短期内自建大模型可能面临诸多挑战，但从长远来看，掌握核心技术能力对于企业的发展至关重要。通过不断积累经验和优化算法，中小型企业在未来将能够更好地应对市场变化和技术革新带来的机遇与挑战。

综上所述，尽管训练大模型确实存在一定的难度和成本，但通过合理利用现有资源、加强合作以及注重长期发展等策略，中小型企业完全有可能克服这些障碍，并从中获得巨大的收益。
2025-02-10 15:45:04.889 | WARNING  | metagpt.utils.cost_manager:update_cost:49 - Model qwen2.5:7b not found in TOKEN_COSTS.
2025-02-10 15:45:04.894 | INFO     | __main__:_act:56 - Fan(反方): to do SpeakAloud(SpeakAloud)
好的，针对Zheng提出的四个方面的反驳，我会从以下几个角度进行回应：

### 1. 成本效益分析

虽然Zheng提到云服务和开源工具降低了门槛，但这些优势并不意味着中小型企业能够轻松应对。首先，即使是使用云服务，也需要一定的技术知识来配置和管理资源，这对于缺乏相关经验的团队来说是一个挑战。其次，长期来看，持续的数据输入和模型优化可能需要高昂的成本，而这些成本对于中小型企业的财务状况构成了压力。此外，依赖外部API接口或订阅服务可能会限制企业对数据使用的灵活性，并且在某些情况下，这些服务可能并不完全符合企业的具体需求。

### 2. 差异化竞争

Zheng强调了差异化竞争的重要性，但自建大模型并非唯一途径来实现这一点。通过与其他企业合作、利用现有的成熟技术或者开发小而精的解决方案，同样可以满足特定市场的需求，并且成本更低、风险更可控。此外，过度依赖自建大模型可能会导致资源分散和效率低下，反而不利于企业的核心竞争力提升。

### 3. 合作与共享

虽然合作是一个好的策略，但Zheng忽视了合作中的潜在问题。合作可能带来技术共享和技术互补的优势，但也存在知识产权保护、数据安全以及利益分配等方面的复杂性。对于中小型企业来说，在这些方面缺乏经验和资源可能会导致合作效果不佳甚至产生纠纷。

### 4. 长期发展潜力

最后一点关于长期发展的观点虽然有一定道理，但并不足以证明中小型企业在当前阶段应该投资于大模型开发。技术的发展是快速的，而市场的变化同样迅速。在短期内，中小型企业更需要关注的是如何利用现有资源和能力来应对市场挑战，并通过灵活多变的方式不断适应环境的变化。

综上所述，我认为Zheng提出的这些观点虽然有一定道理，但并不足以完全否定中小型企业在当前阶段不投资于大模型开发的可能性。相反，我认为应该根据企业的实际情况和发展战略来选择最适合自己的技术路径。
2025-02-10 15:45:11.824 | WARNING  | metagpt.utils.cost_manager:update_cost:49 - Model qwen2.5:7b not found in TOKEN_COSTS.
2025-02-10 15:45:11.828 | INFO     | __main__:_act:56 - Zheng(正方): to do SpeakAloud(SpeakAloud)
好的，针对Fan提出的几点反驳，我会从以下几个方面进行回应：

### 1. 成本效益分析

首先，Fan提到使用云服务和开源工具虽然降低了门槛，但同时也存在技术知识要求高、长期成本高昂以及灵活性受限的问题。然而，这并不意味着中小型企业在自建大模型上就毫无优势。事实上，通过合理规划和利用现有资源，中小型企业可以实现更加高效的成本控制。

- **定制化解决方案**：相比于依赖外部API或订阅服务，自建大模型能够提供更灵活的定制化选项。例如，在特定行业领域内，企业可以根据自身需求调整模型参数以优化性能，从而更好地满足客户的个性化需求。
  
- **长期成本节约**：虽然初期投入可能较高，但长远来看，通过自主开发和维护模型，企业在数据输入、模型迭代等方面可以实现更高的效率和更低的成本。此外，随着技术的进步和服务的成熟化，云服务的价格也在逐步下降。

### 2. 差异化竞争

Fan认为差异化竞争可以通过合作或开发小而精的解决方案来实现，但这种观点忽视了自建大模型在创新方面的潜力。通过掌握核心技术能力，企业不仅能够更好地理解自身业务流程和客户需求，还能快速响应市场变化并推出更具竞争力的产品。

- **技术积累与创新能力**：自建大模型有助于企业在长期发展中积累宝贵的技术经验和知识库，从而增强核心竞争力。这不仅能提升企业的品牌价值，还能够在面对竞争对手时占据有利位置。
  
- **客户信任度提升**：通过提供基于自身数据训练的定制化解决方案，企业能够赢得客户的高度信赖和支持。这种信任关系对于建立长期合作关系至关重要。

### 3. 合作与共享

Fan提到合作中的复杂性和潜在问题确实存在，但并不意味着中小型企业在当前阶段无法参与其中。实际上，中小型企业可以通过与其他企业和研究机构建立战略联盟或参与开源项目等方式，在确保自身利益的前提下实现资源共享和技术互补。

- **灵活的合作模式**：企业可以根据自身的资源和能力选择合适的合作伙伴，并通过签订明确的协议来规避潜在风险。例如，可以先从短期合作开始，逐步建立起互信关系后再考虑更深入的合作。
  
- **政府与行业组织的支持**：许多国家和地区都出台了相关政策鼓励中小企业参与技术创新活动，如提供资金援助、技术支持等。这些外部资源可以帮助企业克服技术和经济上的障碍。

### 4. 长期发展潜力

最后，Fan认为短期内自建大模型可能面临诸多挑战，但从长远来看掌握核心技术能力对于企业发展至关重要。这一观点非常有道理，但同样需要结合实际情况来分析。

- **技术迭代与市场适应性**：通过不断积累经验和优化算法，中小型企业不仅能够跟上技术发展的步伐，还能在快速变化的市场环境中保持竞争力。
  
- **应对未来挑战的能力**：掌握核心技术能力有助于企业在未来面对新兴技术和市场需求时迅速作出反应。这不仅能增强企业的抗风险能力，还能够在关键时刻抓住机遇实现突破性发展。

综上所述，尽管Fan提出了许多合理的担忧和建议，但我认为中小型企业在当前阶段仍然有必要考虑自建大模型的可能性。通过合理规划、灵活合作以及注重长期发展潜力等策略，企业完全有可能克服现有挑战并从中获得巨大收益。
2025-02-10 15:45:23.456 | WARNING  | metagpt.utils.cost_manager:update_cost:49 - Model qwen2.5:7b not found in TOKEN_COSTS.
2025-02-10 15:45:23.461 | INFO     | __main__:_act:56 - Fan(反方): to do SpeakAloud(SpeakAloud)
好的，针对Zheng的最新回应，我会从以下几个角度进行反驳：

### 1. 成本效益分析

首先，虽然Zheng提到自建大模型可以提供更灵活的定制化选项和长期成本节约的可能性，但这些优势并不足以完全抵消初期高投入带来的风险。具体来说：

- **技术门槛与资源要求**：自建大模型不仅需要大量的数据和技术知识，还需要强大的计算资源支持。对于缺乏相关经验和技术积累的中小型企业而言，这是一道难以逾越的技术鸿沟。
  
- **灵活性受限问题**：虽然可以进行定制化调整，但这种灵活性往往伴随着更高的维护成本和复杂性。在实际操作中，频繁的数据输入和模型优化可能会导致运营效率低下。

### 2. 差异化竞争

Zheng强调了自建大模型在创新方面的潜力，但这并不意味着这是唯一或最有效的差异化途径。具体来说：

- **资源分散风险**：过度依赖自建大模型可能会分散企业的核心竞争力。企业在技术开发上的投入可能会影响其在主营业务上的专注度和效率。
  
- **市场响应速度**：通过合作或利用成熟的技术解决方案，企业可以更快地推出产品和服务，并迅速适应市场的变化。这种灵活性对于快速迭代的市场尤为重要。

### 3. 合作与共享

Zheng提到可以通过灵活的合作模式来规避风险，但现实中合作中的复杂性和潜在问题依然存在：

- **利益分配不均**：在合作中，如何确保各方的利益得到合理分配是一个长期且复杂的议题。如果处理不当，可能会引发内部矛盾和纠纷。
  
- **技术保密与知识产权保护**：在参与开源项目或与其他企业合作时，技术保密和知识产权保护是关键问题。这不仅需要强大的法律支持，还需要高度的技术安全措施。

### 4. 长期发展潜力

最后，Zheng强调了长期技术积累的重要性，但这种观点忽视了当前市场环境的不确定性：

- **快速变化的市场需求**：技术发展和市场需求都在不断变化，掌握核心技术能力并不意味着能够完全适应未来的挑战。企业需要灵活应对各种可能性。
  
- **资金与资源限制**：对于许多中小型企业在初期阶段来说，有限的资金和资源可能无法支持长期的技术研发计划。

综上所述，虽然自建大模型在某些方面确实具有优势，但这些优势并不能全面覆盖其带来的风险和挑战。相比之下，通过合作或利用成熟技术解决方案，企业可以更快速、灵活地应对市场变化，并有效降低初期投入的风险。因此，在当前阶段，中小型企业在考虑自建大模型的同时，应更加重视选择适合自身发展的策略。通过合理规划、灵活合作以及注重实际效益，企业同样能够实现长期发展和竞争力提升。这样的策略不仅能够规避风险，还能确保企业在快速变化的市场环境中保持灵活性和竞争力。 

希望这个反驳能够充分展示你的立场并有效攻击对手的观点。如果你需要进一步细化或调整某个部分，请随时告诉我！
2025-02-10 15:45:34.817 | WARNING  | metagpt.utils.cost_manager:update_cost:49 - Model qwen2.5:7b not found in TOKEN_COSTS.
2025-02-10 15:45:34.822 | INFO     | __main__:_act:56 - Zheng(正方): to do SpeakAloud(SpeakAloud)
好的，我会继续深入分析Zheng的观点，并提出更为具体的反驳意见。以下是针对每个角度的具体回应：

### 1. 成本效益分析

**回应：**
虽然自建大模型确实可以提供定制化和长期成本节约的可能性，但这些优势在实际操作中面临诸多挑战。

- **技术门槛与资源要求**：
  - 自建大模型需要大量的专业知识和技术积累。对于缺乏经验的中小型企业来说，这是一道难以逾越的技术鸿沟。即使有外部支持或合作，短期内仍需投入大量时间和资金进行培训和学习。
  - 计算资源需求也是一个重要问题。高性能计算集群不仅成本高昂，还需要专业的运维团队来维护，这对于预算有限的小企业来说是一个巨大的负担。

- **灵活性受限问题**：
  - 虽然可以进行定制化调整，但频繁的数据输入和模型优化确实会增加运营复杂性和成本。在实际操作中，这种灵活性往往需要额外的IT支持和人力资源，进一步增加了企业的负担。
  - 灵活性并不总是优势。过度依赖自建模型可能导致企业内部资源分散，影响核心业务的发展。

### 2. 差异化竞争

**回应：**
Zheng强调了自建大模型在创新方面的潜力，但这种观点忽视了其他更为有效的差异化途径。

- **资源分散风险**：
  - 过度依赖自建大模型确实会分散企业的核心竞争力。企业在技术开发上的投入可能会减少对主营业务的关注和投资。
  - 灵活合作或利用成熟的技术解决方案可以更快地推出产品和服务，迅速适应市场变化。这种灵活性对于快速迭代的市场尤为重要。

- **市场响应速度**：
  - 利用成熟的解决方案不仅可以加快产品上市时间，还能降低研发成本。例如，采用云服务提供商的机器学习平台，企业可以在短时间内获得所需的技术支持和资源。
  - 灵活性高的合作模式可以确保企业在面对市场变化时能够迅速调整策略。

### 3. 合作与共享

**回应：**
Zheng提到可以通过灵活的合作模式来规避风险，但现实中合作中的复杂性和潜在问题依然存在。

- **利益分配不均**：
  - 在合作中确实需要明确的利益分配机制。如果处理不当，可能会引发内部矛盾和纠纷。
  - 合作伙伴的选择至关重要。选择合适的合作伙伴可以确保技术共享和技术保密的顺利进行，而选择不当则可能导致项目失败或泄露核心技术。

- **技术保密与知识产权保护**：
  - 在参与开源项目或与其他企业合作时，确实需要强大的法律支持和技术安全措施来保障技术保密和知识产权。
  - 然而，这些措施不仅成本高昂，还需要专业的团队进行管理和维护。对于预算有限的中小企业来说，这是一大挑战。

### 4. 长期发展潜力

**回应：**
Zheng强调了长期技术积累的重要性，但这种观点忽视了当前市场环境的不确定性。

- **快速变化的市场需求**：
  - 技术发展和市场需求都在不断变化。掌握核心技术能力并不意味着能够完全适应未来的挑战。
  - 灵活应对各种可能性更为重要。通过合作或利用成熟的技术解决方案，企业可以更快地响应市场变化，并在必要时迅速调整策略。

- **资金与资源限制**：
  - 对于许多中小型企业在初期阶段来说，有限的资金和资源确实无法支持长期的技术研发计划。
  - 灵活的合作模式可以在短期内提供必要的技术支撑，同时避免过早的高投入风险。通过外部合作，企业可以逐步积累技术和经验，并在适当的时候进行自主开发。

### 总结

综上所述，虽然自建大模型在某些方面确实具有优势，但这些优势并不能全面覆盖其带来的风险和挑战。相比之下，通过合作或利用成熟技术解决方案，企业可以更快速、灵活地应对市场变化，并有效降低初期投入的风险。因此，在当前阶段，中小型企业在考虑自建大模型的同时，应更加重视选择适合自身发展的策略。

希望这个反驳能够充分展示你的立场并有效攻击对手的观点。如果你需要进一步细化或调整某个部分，请随时告诉我！
2025-02-10 15:45:50.835 | WARNING  | metagpt.utils.cost_manager:update_cost:49 - Model qwen2.5:7b not found in TOKEN_COSTS.